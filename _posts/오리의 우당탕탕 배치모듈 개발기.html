---
layout: post
title: "오리의 우당탕탕 배치모듈 개발기"
subtitle: "배치모듈 개발기"
date: 2023-10-17 15:45:13 -0400
background: '/img/posts/01.jpg'
---
<!doctype html>
<html>
<head><title>오리의 우당탕탕 배치모듈 개발기</title>
    <base href="./">
    <meta id="root-path" root-path="./">
    <link rel="icon" sizes="96x96"
          href="https://publish-01.obsidian.md/access/f786db9fac45774fa4f0d8112e232d67/favicon-96x96.png">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,user-scalable=yes,minimum-scale=1,maximum-scale=5">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="lib/styles/obsidian-styles.css">
    <link rel="stylesheet" href="lib/styles/theme.css">
    <link rel="stylesheet" href="lib/styles/plugin-styles.css">
    <link rel="stylesheet" href="lib/styles/snippets.css">
    <link rel="stylesheet" href="lib/styles/generated-styles.css">
    <style></style>
    <script type="module" src="lib/scripts/graph_view.js"></script>
    <script src="lib/scripts/graph_wasm.js"></script>
    <script src="lib/scripts/tinycolor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"
            integrity="sha512-Ch/O6kL8BqUwAfCF7Ie5SX1Hin+BJgYH4pNjRqXdTEqMsis1TUYg+j6nnI9uduPjGaj7DN4UKCZgpvoExt6dkw=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="lib/scripts/webpage.js"></script>
    <script src="lib/scripts/generated.js"></script>
</head>
<body class="theme-dark show-inline-title loading">
<div class="webpage-container">
    <div class="sidebar-left sidebar">
        <div class="sidebar-container">
            <div class="sidebar-sizer">
                <div class="sidebar-content-positioner">
                    <div class="sidebar-content">
                        <div><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input"
                                                                                             type="checkbox"
                                                                                             id="theme_toggle">
                            <div class="toggle-background"></div>
                        </label></div>
                        <div class="tree-container file-tree mod-nav-indicator" data-depth="0">
                            <div class="tree-header"><span class="sidebar-section-header">Obsidian Vault</span>
                                <button class="clickable-icon collapse-tree-button is-collapsed">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round"></svg>
                                </button>
                            </div>
                            <div class="tree-scroll-area">
                                <div class="tree-item mod-tree-file" data-depth="1">
                                    <div class="tree-item-contents"><a class="internal-link tree-item-link"
                                                                       href="오리의-우당탕탕-배치모듈-개발기.html"><span
                                            class="tree-item-title">오리의 우당탕탕 배치모듈 개발기</span></a></div>
                                    <div class="tree-item-children"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sidebar-gutter">
            <div class="clickable-icon sidebar-collapse-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                     class="svg-icon">
                    <path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path>
                    <path d="M10 4V20"></path>
                    <path d="M4 7H7"></path>
                    <path d="M4 10H7"></path>
                    <path d="M4 13H7"></path>
                </svg>
            </div>
        </div>
    </div>
    <div class="document-container show">
        <div class="markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings show-indentation-guide allow-fold-lists show-properties"
             style="tab-size:4">
            <style id="MJX-CHTML-styles"></style>
            <div class="markdown-preview-sizer markdown-preview-section" style="min-height:5490px">
                <div class="markdown-preview-pusher" style="width:1px;height:.1px;margin-bottom:0"></div>
                <div class="mod-header">
                    <div class="inline-title" data-heading="오리의 우당탕탕 배치모듈 개발기" id="오리의_우당탕탕_배치모듈_개발기"
                         style="display:block">오리의 우당탕탕 배치모듈 개발기
                    </div>
                </div>
                <div><p>새로운 일상, 새로운 기회.<br>오리는 따뜻한 커피 한 잔을 손에 들고 사무실에 앉았어요.<br>오리는 대용량 데이터를 가공하여 통계를 낼 수 있는 배치 모듈 개발을
                    담당하게 됐어요.<br>서비스를 운영 및 관리하면서 프로세스는 나름 잘 알게 되었다고 자신하며 프로젝트를 시작한 오리</p></div>
                <div>
                    <div data-callout-metadata="" data-callout-fold="" data-callout="info" class="callout">
                        <div class="callout-title">
                            <div class="callout-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" fill="none"
                                     stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round" class="svg-icon lucide-info"
                                     style="width:24px;max-width:100%">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </div>
                            <div class="callout-title-inner">&nbsp;서비스는 <strong>[A,B,C,D]</strong> 4가지로 이루어져 있고, 데이터는
                                하루에는 대략 30 ~ 50만 건이 쌓인다고 해요.
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div data-callout-metadata="" data-callout-fold="" data-callout="question" class="callout">
                        <div class="callout-title">
                            <div class="callout-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" fill="none"
                                     stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round" class="svg-icon lucide-help-circle"
                                     style="width:24px;max-width:100%">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                            </div>
                            <div class="callout-title-inner">아래는 프로젝트 시작 전 전달받았던 요구사항이에요.</div>
                        </div>
                        <div class="callout-content">
                            <ol>
                                <li data-line="1">데이터를 [10분, 일별, 월별] 단위로 나누어 처리해야 해요.</li>
                                <li data-line="2">다중화된 서버 환경에서의 데이터 처리를 고려해야 해요.</li>
                                <li data-line="3">30분 이전의 데이터를 통계 내어야 해요</li>
                                <li data-line="4">결과 통계가 명확해야 해요.</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div><p>오리는 생각했어요.<br>"4개의 서비스의 사용 건수를 10분 단위로 집계하고 10분 단위로 집계된 데이터를 다시 일별로 집계하고 마찬가지로 월별도 일별을 집계하는 방식으로
                    가면 되겠구나."<br>"토비의 스프링에서 봤던 @Transactional을 사용해서 트랜젝션을 관리한다면 다중화된 서버 환경에서도 안전하게 데이터를 수집하고 관리할 수
                    있겠구나!"</p></div>
                <div><p>[이미지 - 4개의 서비스의 통계를 하나로 합치고 그 하나를 다시 합치고 또 합치는 이미지<br>A,B,C,D =&gt; @ =&gt; {@} =&gt; [{@}]]</p>
                </div>
                <div class="heading-wrapper">
                    <h3 data-heading="데이터 동기화와 쿼리 최적화" class="heading" id="데이터_동기화와_쿼리_최적화">
                        <div class="heading-before"></div>
                        <div class="heading-collapse-indicator collapse-indicator collapse-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                 class="svg-icon right-triangle" style="width:24px;max-width:100%">
                                <path d="M3 8L12 17L21 8"></path>
                            </svg>
                        </div>
                        데이터 동기화와 쿼리 최적화
                        <div class="heading-after">...</div>
                    </h3>
                    <div class="heading-children">
                        <div><p>오리는 서비스별로 쌓이는 데이터를 하나로 합칠 필요가 있었어요.<br>10분 단위, 하루 단위, 한 달 단위로 통계 테이블을 각각 생성하고, 관리해야 했어요.<br>조회와
                            삽입 쿼리를 생성하는데 조회해야 하는 테이블이 너무 많았어요. (조회 해와야 하는 테이블 9개...)</p></div>
                        <div><p>이렇게 실시간으로 대량의 데이터가 쌓이는 상황에서, 여러 테이블과 데이터베이스 간의 효율적인 데이터 처리 방안을 고려하게 됐어요.</p></div>
                        <div>
                            <div data-callout-metadata="" data-callout-fold="" data-callout="todo"
                                 class="callout node-insert-event">
                                <div class="callout-title">
                                    <div class="callout-icon">
                                        <svg height="16" style="width:16px;max-width:100%"></svg>
                                    </div>
                                    <div class="callout-title-inner">오리가 떠올린 고려사항과 방법은 다음과 같아요.</div>
                                </div>
                                <div class="callout-content"><p>A. 다중화된 서버 환경에서 데이터 처리 작업의 분산 및 병렬 처리<br>B. 데이터의 일관성과
                                    정확성을 유지하면서 빠른 처리가 가능한 DB 쿼리 최적화 방안<br>C. 코드를 알아보기 쉽고 유지보수하기 편하게 만들자</p></div>
                            </div>
                        </div>
                        <div><p>오리는 데이터의 일관성과 처리 속도를 동시에 고려하기 위해 조회와 삽입 작업을 동시에 수행하는 쿼리를 작성하기로 했어요.</p></div>
                        <div><p>[SQL 수정 필요 컬럼명 , 테이블명, 파라미터 값]</p></div>
                        <div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span
                                class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STAT_MIN
<span class="token punctuation">(</span>FROM_DATE<span class="token punctuation">,</span> MOK_CLIENT_ID<span
                                    class="token punctuation">,</span> SITE_ID<span class="token punctuation">,</span> PROVIDER_ID<span
                                    class="token punctuation">,</span> SERVICE_TYPE<span
                                    class="token punctuation">,</span> REQ_CNT<span class="token punctuation">,</span> INCOMPLETE_CNT<span
                                    class="token punctuation">,</span>
 SUCCESS_FINAL_CNT<span class="token punctuation">,</span>
 FAIL_CNT<span class="token punctuation">,</span>
 REG_DATE<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token comment">#{fromDate}      AS FROM_DATE  </span>
     <span class="token punctuation">,</span> MOK_CLIENT_ID
     <span class="token punctuation">,</span> SITE_ID
     <span class="token punctuation">,</span> PROVIDER_ID
     <span class="token punctuation">,</span> <span class="token string">'TELCOAUTH'</span>      <span
                                    class="token keyword">AS</span> SERVICE_TYPE
     <span class="token punctuation">,</span> <span class="token function">COUNT</span><span
                                    class="token punctuation">(</span>REQ_TX_ID<span class="token punctuation">)</span> <span
                                    class="token keyword">AS</span> REQ_CNT
     <span class="token punctuation">,</span> <span class="token function">COUNT</span><span
                                    class="token punctuation">(</span>
        <span class="token keyword">CASE</span>            <span class="token keyword">WHEN</span> AUTH_TYPE <span
                                    class="token operator">=</span> <span class="token string">'authReq'</span> <span
                                    class="token operator">AND</span> RESULT_CODE <span class="token operator">IN</span> <span
                                    class="token punctuation">(</span><span class="token string">'2000'</span><span
                                    class="token punctuation">)</span>
                <span class="token operator">OR</span> AUTH_TYPE <span class="token operator">=</span> <span
                                    class="token string">'authResultKey'</span>
                <span class="token operator">OR</span> AUTH_TYPE <span class="token operator">=</span> <span
                                    class="token string">'authVerify'</span>
                <span class="token keyword">THEN</span> <span class="token number">1</span>
            <span class="token keyword">END</span>
    <span class="token punctuation">)</span>                   <span
                                    class="token keyword">AS</span> INCOMPLETE_CNT <span class="token comment">/*요청 성공 건수*/</span>
     <span class="token punctuation">,</span> <span class="token function">COUNT</span><span
                                    class="token punctuation">(</span>
        <span class="token keyword">CASE</span>            <span class="token keyword">WHEN</span> AUTH_TYPE <span
                                    class="token operator">=</span> <span class="token string">'authVerify'</span> <span
                                    class="token operator">AND</span> RESULT_CODE <span class="token operator">IN</span> <span
                                    class="token punctuation">(</span><span class="token string">'2000'</span><span
                                    class="token punctuation">)</span>
                <span class="token operator">OR</span> AUTH_TYPE <span class="token operator">=</span> <span
                                    class="token string">'authResultKey'</span> <span class="token operator">AND</span> RESULT_CODE <span
                                    class="token operator">IN</span> <span class="token punctuation">(</span><span
                                    class="token string">'2000'</span><span class="token punctuation">)</span>
                <span class="token keyword">THEN</span> <span class="token number">1</span>
            <span class="token keyword">END</span>
    <span class="token punctuation">)</span>                   <span
                                    class="token keyword">AS</span> SUCCESS_FINAL_CNT <span class="token comment">/* 최종 성공 건수 */</span>
     <span class="token punctuation">,</span> <span class="token function">COUNT</span><span
                                    class="token punctuation">(</span>REQ_TX_ID<span class="token punctuation">)</span> <span
                                    class="token operator">-</span> <span class="token function">COUNT</span><span
                                    class="token punctuation">(</span>
        <span class="token keyword">CASE</span>            <span class="token keyword">WHEN</span> AUTH_TYPE <span
                                    class="token operator">=</span> <span class="token string">'authReq'</span> <span
                                    class="token operator">AND</span> RESULT_CODE <span class="token operator">IN</span> <span
                                    class="token punctuation">(</span><span class="token string">'2000'</span><span
                                    class="token punctuation">)</span>
                <span class="token operator">OR</span> AUTH_TYPE <span class="token operator">=</span> <span
                                    class="token string">'authResultKey'</span>
                <span class="token operator">OR</span> AUTH_TYPE <span class="token operator">=</span> <span
                                    class="token string">'authVerify'</span>
                <span class="token keyword">THEN</span> <span class="token number">1</span>
            <span class="token keyword">END</span>
    <span class="token punctuation">)</span>                   <span class="token keyword">AS</span> FAIL_CNT <span
                                    class="token comment">/* 실패 건수*/</span>
     <span class="token punctuation">,</span> <span class="token comment">#{regDate}       AS REG_DATE  </span>
<span class="token keyword">FROM</span> TELCOAUTH_HISTORY
<span class="token keyword">WHERE</span> <span class="token number">1</span> <span class="token operator">=</span> <span
                                    class="token number">1</span>
  <span class="token operator">AND</span> REG_DATE <span class="token operator">&amp;</span>gt<span
                                    class="token punctuation">;</span><span class="token operator">=</span> <span
                                    class="token comment">#{statFromDate}  </span>
  <span class="token operator">AND</span> REG_DATE <span class="token operator">&amp;</span>lt<span
                                    class="token punctuation">;</span> <span
                                    class="token comment">#{statToDate}  </span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> SITE_ID<span
                                    class="token punctuation">,</span> PROVIDER_ID<span
                                    class="token punctuation">,</span> MOK_CLIENT_ID
</code><button class="copy-code-button">복사</button></pre>
                        </div>
                        <div><p>조회와 삽입을 하나의 쿼리에서 진행하다보니 쿼리 최적화가 필요했고, DB 인덱싱을 통해 오랜시간 DB를 점유하는 것을 최소화 시켰어요.<br>[이미지 스마일]
                        </p></div>
                        <div>
                            <div data-callout-metadata="" data-callout-fold="" data-callout="tip"
                                 class="callout node-insert-event">
                                <div class="callout-title">
                                    <div class="callout-icon">
                                        <svg height="16" style="width:16px;max-width:100%"></svg>
                                    </div>
                                    <div class="callout-title-inner heading-wrapper">
                                        <h4 data-heading="분리하여 사용하는 방법의 장단점" class="heading" id="분리하여_사용하는_방법의_장단점">
                                            <div class="heading-before"></div>
                                            <div class="heading-collapse-indicator collapse-indicator collapse-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24"
                                                     fill="none" stroke="currentColor" stroke-width="2"
                                                     stroke-linecap="round" stroke-linejoin="round"
                                                     class="svg-icon right-triangle" style="width:24px;max-width:100%">
                                                    <path d="M3 8L12 17L21 8"></path>
                                                </svg>
                                            </div>
                                            분리하여 사용하는 방법의 장단점
                                            <div class="heading-after">...</div>
                                        </h4>
                                        <div class="heading-children"></div>
                                    </div>
                                </div>
                                <div class="callout-content"><p><strong>장점</strong>:</p>
                                    <ol>
                                        <li data-line="2"><strong>명확한 로직 분리와 확장성</strong>: 조회와 삽입 로직이 분리되어 있기 때문에 각 기능별로
                                            코드를 사용할 수 있고, 활용해서 사용할 수 있어요.
                                        </li>
                                        <li data-line="3"><strong>유연한 유지보수</strong>: 한 쪽의 로직만 변경해야 할 경우, 다른 쪽에 영향을 미치지
                                            않아 유지보수가 편리해요.
                                        </li>
                                        <li data-line="4"><strong>오류 예방</strong>: 삽입과 조회 중 하나에서 오류가 발생하더라도 다른 로직에는 영향을
                                            미치지 않아요.
                                        </li>
                                    </ol>
                                    <p><strong>단점</strong>:</p>
                                    <ol>
                                        <li data-line="7"><strong>통신 횟수 증가</strong>: 조회와 삽입이 따로 이루어지기 때문에, 데이터베이스와의 통신
                                            횟수가 증가해요. 이로 인해 전체적인 처리 시간이 길어질 수 있어요.
                                        </li>
                                        <li data-line="8"><strong>트랜잭션 관리 어려움</strong>: 조회 후 삽입이 이루어져야 하는 상황에서는 트랜잭션 관리가
                                            복잡해질 수 있어요.
                                        </li>
                                        <li data-line="9"><strong>일관성 유지의 어려움</strong>: 조회와 삽입이 따로 이루어질 경우, 조회 후에 데이터
                                            상태가 변경될 가능성이 있어, 삽입 시점의 데이터 일관성 유지가 어려울 수 있어요.
                                        </li>
                                        <li data-line="10"><strong>복잡한 예외 처리</strong>: 조회와 삽입 작업이 따로 이루어지면, 각각의 작업에서 발생할
                                            수 있는 예외 상황을 따로 처리해야해요.
                                        </li>
                                        <li data-line="11"><strong>리소스 비효율</strong>: 두 개의 쿼리를 실행하기 때문에, 리소스 사용량이 증가하며,
                                            이로 인해 전반적인 시스템 퍼포먼스가 저하될 수 있어요.
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div data-callout-metadata="" data-callout-fold="" data-callout="tip"
                                 class="callout node-insert-event">
                                <div class="callout-title">
                                    <div class="callout-icon">
                                        <svg height="16" style="width:16px;max-width:100%"></svg>
                                    </div>
                                    <div class="callout-title-inner heading-wrapper">
                                        <h3 data-heading="조회와 삽입 작업을 동시에 수행하는 쿼리의 장단점:" class="heading"
                                            id="조회와_삽입_작업을_동시에_수행하는_쿼리의_장단점:">
                                            <div class="heading-before"></div>
                                            <div class="heading-collapse-indicator collapse-indicator collapse-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24"
                                                     fill="none" stroke="currentColor" stroke-width="2"
                                                     stroke-linecap="round" stroke-linejoin="round"
                                                     class="svg-icon right-triangle" style="width:24px;max-width:100%">
                                                    <path d="M3 8L12 17L21 8"></path>
                                                </svg>
                                            </div>
                                            조회와 삽입 작업을 동시에 수행하는 쿼리의 장단점:
                                            <div class="heading-after">...</div>
                                        </h3>
                                        <div class="heading-children"></div>
                                    </div>
                                </div>
                                <div class="callout-content"><p><strong>장점</strong>:</p>
                                    <ol>
                                        <li data-line="3"><strong>통신 횟수 감소</strong>: 단 한 번의 쿼리로 두 가지 작업을 처리할 수 있기 때문에,
                                            DB와의 통신 횟수를 줄일 수 있습니다.
                                        </li>
                                        <li data-line="4"><strong>일관성 보장</strong>: 조회와 삽입이 동시에 이루어지므로, 데이터의 일관성을 보장할 수
                                            있습니다.
                                        </li>
                                        <li data-line="5"><strong>트랜잭션 관리의 간소화</strong>: 하나의 쿼리에서 처리되기 때문에 트랜잭션 관리가 더욱
                                            간편해집니다.
                                        </li>
                                    </ol>
                                    <p><strong>단점</strong>:</p>
                                    <ol>
                                        <li data-line="9"><strong>로직 복잡성</strong>: 조회와 삽입을 동시에 처리하는 쿼리는 로직이 복잡해질 수 있으며,
                                            이로 인해 유지보수가 어려워질 수 있습니다.
                                        </li>
                                        <li data-line="10"><strong>오류 예방의 어려움</strong>: 쿼리에 오류가 발생하면, 조회와 삽입 둘 다에 문제가 생길
                                            수 있습니다. 이 경우, 오류의 원인 파악이 복잡해질 수 있습니다.
                                        </li>
                                        <li data-line="11"><strong>튜닝의 어려움</strong>: 동시에 수행하는 쿼리는 최적화하기가 더 어려울 수 있습니다.
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div><p>오리는 다중화된 서버 환경에서 자신이 만든 모듈을 배포하게 된다고하니 생각이 많아졌어요..<br>데이터가 삽입되는도중 데드락이 걸리면안돼..<br>오리는
                            데이터의 순차적인 삽입 처리를 위해 DB lock 테이블을 생성해요.</p></div>
                        <div class="heading-wrapper">
                            <h4 data-heading="DB lock 테이블을 사용한 스케줄링 로직 관리" class="heading"
                                id="DB_lock_테이블을_사용한_스케줄링_로직_관리">
                                <div class="heading-before"></div>
                                <div class="heading-collapse-indicator collapse-indicator collapse-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round" class="svg-icon right-triangle"
                                         style="width:24px;max-width:100%">
                                        <path d="M3 8L12 17L21 8"></path>
                                    </svg>
                                </div>
                                DB lock 테이블을 사용한 스케줄링 로직 관리
                                <div class="heading-after">...</div>
                            </h4>
                            <div class="heading-children">
                                <div><p>오리는 데이터베이스에 해당 타겟 메서드가 실행되었을 때의 시간과 실행된 서비스 이름을 DB lock 테이블에 저장하여 관리했어요.<br>이렇게
                                    하면 동시에 같은 데이터를 수정하려는 다른 요청이나 스케쥴러 작업을 효과적으로 방지할 수 있어요.</p></div>
                                <div><p>오리는 통계를 내고 삽입하는 로직이 실행되는 동안 다른 인스턴스나 스레드가 동일한 작업을 동시에 실행하는 것을 방지했어요.</p></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="heading-wrapper">
                    <h2 data-heading="데이터 동기화와 동시성 관리" class="heading" id="데이터_동기화와_동시성_관리">
                        <div class="heading-before"></div>
                        <div class="heading-collapse-indicator collapse-indicator collapse-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                 class="svg-icon right-triangle" style="width:24px;max-width:100%">
                                <path d="M3 8L12 17L21 8"></path>
                            </svg>
                        </div>
                        데이터 동기화와 동시성 관리
                        <div class="heading-after">...</div>
                    </h2>
                    <div class="heading-children">
                        <div><p>그런데 어느날!<br>서비스를 이용하는 업체가 이벤트를 진행했고,<br>이 이벤트는 예상을 뛰어넘는 선풍적인 인기를 끌었고, 사용자들의 폭발적인 참여로 인해
                            데이터 처리가 복잡해졌어요.<br>이로 인해 통계 데이터 처리하는 과정에도 여러 문제를 발견하게 되었어요.<br>SQLIntegrityConstraintViolationException:
                            Duplicate entry 오류와<br>java.sql.SQLSyntaxErrorException : Truncated incorrect DOUBLE value:
                            ''오류가 발생했었어요.<br>[이미지 눈물 + 폭발]</p></div>
                        <div><p>대량의 오류 코드를 찍고있던 배치모듈을 정지시키고 나서 생각했어요.<br>이미 인서트 되어있는 데이터와 다음 트랜잭션의 데이터와 동시에 얽히면서 발생한
                            중복오류인지,<br>데이터 자체에 중복값이 들어와서 발생한 문제인지 알 수가 없었어요.</p></div>
                        <div><p>하루동안 통계 데이터를 집계하지 못한 오리는 서비스에 대한 사과문을 쓰고 다음에 또 이런일이 발생하더라도 오리가 핸들링 할 수 있도록 하는 방법을 공부해
                            적용하기로 합니다.</p></div>
                        <div><p>[<code>@Transactional</code>과 롤백 처리 관련 정리내용 필요]</p></div>
                        <div class="heading-wrapper">
                            <h3 data-heading="`@Transactional`을 조금 더 활용해보자" class="heading"
                                id="`@Transactional`을_조금_더_활용해보자">
                                <div class="heading-before"></div>
                                <div class="heading-collapse-indicator collapse-indicator collapse-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round" class="svg-icon right-triangle"
                                         style="width:24px;max-width:100%">
                                        <path d="M3 8L12 17L21 8"></path>
                                    </svg>
                                </div>
                                <code>@Transactional</code>을 조금 더 활용해보자
                                <div class="heading-after">...</div>
                            </h3>
                            <div class="heading-children">
                                <div><p>오리는 데이터의 안정성과 정확성을 위해, <code>@Transactional</code> 어노테이션의 활용을 알아보기로요.</p></div>
                                <div>
                                    <ol>
                                        <li data-line="0">일관성 보장 : <code>@Transactional</code> 어노테이션이 붙은 메서드는 실행 중에 예외가
                                            발생하면 자동으로 롤백이 되어 데이터의 일관성을 보장해요.<br>!단 모든 예외에대해서 롤백을 시켜주지 않아요.
                                        </li>
                                        <li data-line="2">선언적 트랜잭션 관리 : 코드 기반의 트랜잭션 관리보다 어노테이션을 사용하는 선언적 트랜잭션 관리가 훨씬
                                            간결하고 직관적이에요.
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div class="heading-wrapper">
                            <h3 data-heading="롤백 처리의 깊은 고려" class="heading" id="롤백_처리의_깊은_고려">
                                <div class="heading-before"></div>
                                <div class="heading-collapse-indicator collapse-indicator collapse-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round" class="svg-icon right-triangle"
                                         style="width:24px;max-width:100%">
                                        <path d="M3 8L12 17L21 8"></path>
                                    </svg>
                                </div>
                                롤백 처리의 깊은 고려
                                <div class="heading-after">...</div>
                            </h3>
                            <div class="heading-children">
                                <div><p><code>@Transactional</code> 어노테이션은 데이터의 일관성을 보장하기 위해 예외 발생 시 트랜잭션을 롤백하는 기능을
                                    제공해요.<br>하지만!! 모든 예외가 데이터의 일관성을 위협하지 않기 때문에, 스프링은 특정 예외에 대해서만 기본적으로 롤백을 수행한다고 해요.
                                </p></div>
                                <div>
                                    <ol>
                                        <li data-line="0"><p><strong>기본 롤백 규칙</strong>:<br>스프링의
                                            <code>@Transactional</code>에서는 런타임 예외(<code>RuntimeException</code>)와 <code>Error</code>가
                                            발생했을 때 기본적으로 롤백을 수행합니다. 반면, 체크 예외(<code>checked exceptions</code>)는 롤백 대상에서
                                            제외됩니다. 이는 체크 예외가 일반적으로 복구 가능한 예외로 간주되기 때문입니다.</p></li>
                                        <li data-line="3"><p><strong>롤백 설정의
                                            커스터마이징</strong>:<br><code>@Transactional</code> 어노테이션의
                                            <code>rollbackFor</code> 속성을 사용하여 롤백을 수행할 예외를 명시적으로 지정할 수 있습니다. 또한, <code>noRollbackFor</code>
                                            속성을 사용하여 롤백을 하지 않을 예외를 지정할 수도 있습니다.</p></li>
                                    </ol>
                                </div>
                                <div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span
                                        class="token annotation punctuation">@Transactional</span><span
                                        class="token punctuation">(</span>rollbackFor <span
                                        class="token operator">=</span> <span
                                        class="token class-name">CustomException</span><span
                                        class="token punctuation">.</span><span class="token keyword">class</span><span
                                        class="token punctuation">)</span>
</code><button class="copy-code-button">복사</button></pre>
                                </div>
                                <div>
                                    <ol start="3">
                                        <li data-line="0"><strong>프로그래밍적 롤백</strong>:<br>때로는 코드 내에서 조건에 따라 롤백을 수행해야 할
                                            경우가 있습니다. 이럴 때는 <code>TransactionAspectSupport</code>의 <code>currentTransactionStatus().setRollbackOnly()</code>
                                            메서드를 호출하여 프로그래밍적으로 롤백을 수행할 수 있습니다.
                                        </li>
                                    </ol>
                                </div>
                                <div><pre class="language-java" tabindex="0"><code class="language-java is-loaded">
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span
                                        class="token punctuation">{</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myTransactionalMethod</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span> <span
                                        class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 어떤 조건에 따라 롤백을 수행하고 싶을 때  </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">someCondition</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span><span
                                        class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 프로그래밍적으로 롤백 수행  </span>
                <span class="token class-name">TransactionAspectSupport</span><span
                                        class="token punctuation">.</span><span class="token function">currentTransactionStatus</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span><span
                                        class="token punctuation">.</span><span
                                        class="token function">setRollbackOnly</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span><span
                                        class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// ... 다른 비즈니스 로직 ...  </span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span
                                        class="token punctuation">(</span><span class="token class-name">SpecificException1</span> e1<span
                                        class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 특정 예외에 대한 처리 로직  </span>
            <span class="token class-name">TransactionAspectSupport</span><span class="token punctuation">.</span><span
                                        class="token function">currentTransactionStatus</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span><span
                                        class="token punctuation">.</span><span
                                        class="token function">setRollbackOnly</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span><span
                                        class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span
                                        class="token punctuation">(</span><span class="token class-name">SpecificException4</span> e2<span
                                        class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 롤백을 수행하지 않는 예외 처리 로직  </span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span
                                        class="token punctuation">(</span><span
                                        class="token class-name">Exception</span> e<span
                                        class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 그 외의 예외에 대한 처리 로직  </span>
            <span class="token class-name">TransactionAspectSupport</span><span class="token punctuation">.</span><span
                                        class="token function">currentTransactionStatus</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span><span
                                        class="token punctuation">.</span><span
                                        class="token function">setRollbackOnly</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span><span
                                        class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">someCondition</span><span
                                        class="token punctuation">(</span><span class="token punctuation">)</span> <span
                                        class="token punctuation">{</span>
        <span class="token comment">// 임의의 조건  </span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span
                                        class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code><button class="copy-code-button">복사</button></pre>
                                </div>
                                <div><p>오리는 롤백 처리하는 다양한 방법에 대해 공부해보고 예외 상황에서도 데이터의 일관성과 안정성을 유지할 수 있는 방법을 배웠습니다.</p>
                                </div>
                                <div>
                                    <hr>
                                </div>
                                <div><p>이를 바탕으로 동시성 관리 전략을 효과적으로 적용하면, 데이터의 안정성과 처리 속도를 동시에 달성할 수 있게 되었어요.</p></div>
                                <div><p><strong>이번 프로젝트는 혼자서 프로젝트를 진행하며 다양한 기술과 환경을 접하게 되었는데, 다양한 기술이 있더라도 그 중에서도 본인에게 꼭
                                    필요한 기술인지 고민하여 적용하는 것</strong>이 중요하다는 깨달음을 얻었습니다. 😊</p></div>
                                <div class="mod-footer"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sidebar-right sidebar">
        <div class="sidebar-gutter">
            <div class="clickable-icon sidebar-collapse-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                     class="svg-icon">
                    <path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path>
                    <path d="M10 4V20"></path>
                    <path d="M4 7H7"></path>
                    <path d="M4 10H7"></path>
                    <path d="M4 13H7"></path>
                </svg>
            </div>
        </div>
        <div class="sidebar-container">
            <div class="sidebar-sizer">
                <div class="sidebar-content-positioner">
                    <div class="sidebar-content">
                        <div class="graph-view-wrapper">
                            <div class="sidebar-section-header">Interactive Graph</div>
                            <div class="graph-view-placeholder">
                                <div class="graph-view-container">
                                    <div class="graph-icon graph-expand" role="button" aria-label="Expand"
                                         data-tooltip-position="top">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                             stroke-linecap="round" stroke-linejoin="round" class="svg-icon">
                                            <line x1="7" y1="17" x2="17" y2="7"></line>
                                            <polyline points="7 7 17 7 17 17"></polyline>
                                        </svg>
                                    </div>
                                    <canvas id="graph-canvas" width="512px" height="512px"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="tree-container outline-tree" data-depth="0">
                            <div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span>
                                <button class="clickable-icon collapse-tree-button">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round"></svg>
                                </button>
                            </div>
                            <div class="tree-scroll-area">
                                <div class="tree-item" data-depth="1">
                                    <div class="tree-item-contents"><a class="internal-link tree-item-link"
                                                                       href="#오리의_우당탕탕_배치모듈_개발기"><span
                                            class="tree-item-title"><p>오리의 우당탕탕 배치모듈 개발기</p></span></a></div>
                                    <div class="tree-item-children">
                                        <div class="tree-item" data-depth="3">
                                            <div class="tree-item-contents"><a class="internal-link tree-item-link"
                                                                               href="#데이터_동기화와_쿼리_최적화"><span
                                                    class="tree-item-title"><p>데이터 동기화와 쿼리 최적화</p></span></a></div>
                                            <div class="tree-item-children"></div>
                                        </div>
                                        <div class="tree-item" data-depth="4">
                                            <div class="tree-item-contents"><a class="internal-link tree-item-link"
                                                                               href="#DB_lock_테이블을_사용한_스케줄링_로직_관리"><span
                                                    class="tree-item-title"><p>DB lock 테이블을 사용한 스케줄링 로직 관리</p></span></a>
                                            </div>
                                            <div class="tree-item-children"></div>
                                        </div>
                                        <div class="tree-item mod-collapsible" data-depth="2">
                                            <div class="tree-item-contents"><a class="internal-link tree-item-link"
                                                                               href="#데이터_동기화와_동시성_관리">
                                                <div class="tree-item-icon collapse-icon">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                         viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                         class="svg-icon right-triangle">
                                                        <path d="M3 8L12 17L21 8"></path>
                                                    </svg>
                                                </div>
                                                <span class="tree-item-title"><p>데이터 동기화와 동시성 관리</p></span></a></div>
                                            <div class="tree-item-children">
                                                <div class="tree-item" data-depth="3">
                                                    <div class="tree-item-contents"><a
                                                            class="internal-link tree-item-link"
                                                            href="#`@Transactional`을_조금_더_활용해보자"><span
                                                            class="tree-item-title"><p><code>@Transactional</code>을 조금 더 활용해보자</p></span></a>
                                                    </div>
                                                    <div class="tree-item-children"></div>
                                                </div>
                                                <div class="tree-item" data-depth="3">
                                                    <div class="tree-item-contents"><a
                                                            class="internal-link tree-item-link"
                                                            href="#롤백_처리의_깊은_고려"><span class="tree-item-title"><p>롤백 처리의 깊은 고려</p></span></a>
                                                    </div>
                                                    <div class="tree-item-children"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>